<p id="notice"><%= notice %></p>

<h3> <%= @countyName %> </h3>





<table border= "1px solid black">
  <thead>
    <tr>
      <th>Location</th>
      <th>Items</th>
      <th>Context</th>
      <th>Website</th>
      <th>Phone</th>
      <th>Address</th>
      <th>Last Verified</th>
      <th>Availability</th>
      <th colspan="1"></th>
    </tr>
  </thead>

  <tbody>
    <% @locations.each do |location| %>
      <tr>
        <td><%= location.name %></td>
        <td>
          <ul>
            <% count=0 %>
            <% @item_locations.for_location(location.id).each do |il| %>
              <% count+=1 %>
              <% if count < 4 %>
                <li><%= il.item.name %></li>
              <% else %>
                <br></br>
                <p><a data-open= "<%=location.id%>Modal" >More...</a></p>


                <% break%>
              <% end %>
            <% end %>

            <div class="reveal" id="<%=location.id%>Modal" data-reveal>

              <h3> <%= location.name %> </h3>

              <form>
                <fieldset class="fieldset">
                  <legend>Items accepted here</legend>
                  <div class="row">

                    <% @item_locations.for_location(location.id).each do |il| %>
                      <input id= "<%= il.location.id %><%= il.item.id %>" type="checkbox"><label><b><%= il.item.name %></b></label>

                    <% end %>

                  </div>
                </fieldset>
              </form>
              <button data-close> Confirm </button>
              <%= link_to 'Edit', edit_location_path(location) %>
              <button style="float:right;" data-close type="button"> Close </button>

            </div>
          </ul>
        </td>
        <td><%= 'Should we have something for this field?' %></td>
        <td><%= location.website %></td>

        <td>
          <% ph = location.phone %>
          <% a = location.phone.gsub!(/\D/, "") %>
          <%= "(#{ph[0..2]})" %>&nbsp;<%="#{ph[3..5]}"%>&nbsp;<%="#{ph[6..-1]}"%>
        </td>
        <td><%= location.address %></td>
        <td>
          <%= "#{location.updated_at.month}/#{location.updated_at.day}/#{location.updated_at.year}" %>

           <br></br>
           <% if (location.updated_at-Time.now).days.round < 0%>

             0 days ago
          <% else %>
               <%= (location.updated_at-Time.now).days.round %> days ago
          <% end %>
         </td>
        <td><%= (if location.active then "Open" else "Closed" end) %></td>
        <td>
          <p><a data-open="<%= location.id %>EditModal" >Edit</a></p>
          <div class="reveal" id="<%= location.id %>EditModal" data-reveal>
            <h3> <%= location.name %> </h3>
            <%= simple_form_for location do |l| %>

              <%= l.input :name %>
              <%= l.input :address %>
              <%= l.input :phone %>
              <%= l.input :website %>
              <%= l.input :city %>
              <%= l.input :state %>
              <%= l.input :active %>
              <%= l.button :submit %>
            <% end %>


            <button class="close-button" data-close aria-label="Close modal" type="button">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        </td>

      </tr>
    <% end %>
  </tbody>
</table>

<br>
